# 🍕HelpUploadFiles

## 🍺简介

***HelpUploadFiles （星空上传助手）*** 是一款支持 **辅助上传** 的工具。我们知道，*git* 提供了 **.gitignore** 文件用于根据规则忽略某些文件的上传，但是这个功能仅限于 *git*，还有很多场景涉及**文件的上传**，比如我们可能需要将某些文件上传到网盘，但是大部分网盘并不具备 ***根据规则忽略指定文件*** 的功能，这十分不方便。另外，还存在着许许多多的上传文件的场景，此时，***HelpUploadFiles*** 油然而生！

由于对于单个文件，不需要特别的规则进行忽略上传，故 ***HelpUploadFiles*** 主要是针对 ***文件夹*** 的上传常见。

## 🍺文件上传概念的推广

***HelpUploadFiles*** 涉及的文件上传并不仅仅局限于将本机文件上传到网盘这种场景，在 ***HelpUploadFiles*** 中，凡是需要 **将某个文件夹发送到某一个接口** 的操作都可推广为文件上传。

以下场景均可视文件上传概念的推广：

1. 将本机文件夹上传到**网盘**
2. 将本机文件夹发送到**另一台设备**（如局域网内设备、服务器对象存储服务等）。
3. 将本机文件夹发送到**压缩软件**等接口。

## 🍻验证通过的应用场景

以下场景均已验证通过：

1. **Chromium 浏览器** 涉及的文件夹上传
2. **Edge 浏览器 **涉及的文件夹上传
3. 百度网盘客户端
4. 腾讯微云客户端
5. 阿里网盘
6. 天翼网盘客户端
7. 中国移动硬盘客户端
8. 联通网盘
9. 谷歌云端硬盘
10. 小飞机网盘
11. 奶牛快传
12. 123云盘
13. 华为云对象存储服务 OBS
14. 阿里云对象存储服务 OSS
15. 腾讯云对象存储服务 COS
16. LocalSend
17. Send Anywhere 客户端
18. WinSCP
19. 7z、Bandizip、360等压缩软件

## 📍使用注意事项

1. ***HelpUploadFiles*** 分为 ***32位*** 与 ***64位***  两个版本，需要根据不同的上传接口选择不同的版本，如目前百度网盘客户端是32位的，则需要使用32位版本的 ***HelpUploadFiles***；而64位系统的Edge浏览器是64位程序，则需要使用64位版本的 ***HelpUploadFiles***。
2. 目前版本(v1.0.2)仅支持同时拦截一个进程的文件上传行为，值得注意的是 ***32位 与 64位版本 加起来一共能同时拦截一个进程***。且 ***添加/移除*** 忽略列表的操作**仅对当前拦截的进程有效**，**若切换进程，即使重新注入，也需要重新添加忽略列表（移除后重新添加），否则将无效。**这是由于目前采用的进程通信方案导致的。
3. 对于下方输入框手动输入的忽略规则，将采用 **C++ 正则表达式规则**。
4. 对于拖拽上传的文件，将自动进行转义使其符合 **C++正则表达式规则**。

## ✨使用步骤（以百度网盘为例，其它应用类似）

1. 打开百度网盘。![百度网盘](https://github.com/KrxkGit/HelpUploadFiles/blob/main/documents/imgs/1.jpg)

2. 🔑打开 ***HelpUploadFiles***，长按鼠标左键，光标将改变表明程序进入捕获状态，此时将鼠标移动到百度网盘主窗口再松开鼠标左键，下图红框处的提示文字也随之改变为 将要**捕获的窗口的标题**（若标题为空则为窗口类名）。

   ![image-20240427053601352](https://github.com/KrxkGit/HelpUploadFiles/blob/main/documents/imgs/2.jpg)

3. 此时会提示是否注入赋能模块到百度网盘，点击确认，百度网盘将打开一个对话框告知 **赋能模块注入成功**（这个对话框是由百度网盘所在进程产生的，一个显然的提示是**对话框的图标是百度网盘的图标**），即表明模块注入成功。如果没有提示赋能模块注入成功，有以下两种可能：

   - 赋能模块在之前已经注入，此次注入为重复注入。
   - 赋能模块注入失败，这表明功能将**不可用**。

   ![image-20240427054456616](https://github.com/KrxkGit/HelpUploadFiles/blob/main/documents/imgs/3.jpg)

   ![image-20240427054258394](https://github.com/KrxkGit/HelpUploadFiles/blob/main/documents/imgs/4.jpg)

   > 请确保在进行下一步前点击 **赋能模块注入成功** 消息框的**确定键**。

4. **添加忽略规则（基于C++正则表达式规则）**

   有两种方式可以添加忽略规则：

   - 可通过将文件拖拽到忽略文件列表。（拖拽文件会自动完成转义，以自动适配正则表达式规则）。
   - 在下方输入框手动输入正则表达式并点击 “**忽略**” 按钮添加（回车也可以）。

   如果需要移除忽略规则，可先选中忽略列表框中的忽略规则，然后点击按钮 "**移除**"即可。

   如下图，我添加了两条忽略规则用以忽略：

   - .idea 文件夹
   - node_modules 文件夹

   ![image-20240427055311356](https://github.com/KrxkGit/HelpUploadFiles/blob/main/documents/imgs/5.jpg)

5. **上传文件**

将需要上传的文件夹拖拽到百度网盘（其它方式也可以）完成上传。匹配忽略规则的文件将不会被上传。

<img src="https://github.com/KrxkGit/HelpUploadFiles/blob/main/documents/imgs/6.jpg" alt="image-20240427055606539"  />

![image-20240427055655356](https://github.com/KrxkGit/HelpUploadFiles/blob/main/documents/imgs/7.jpg)

## ⭐关键步骤分析与经验

上述步骤的 第 2 步是关键步骤，决定了程序能否达到预期效果。

该步骤要考虑两个问题：

1. 使用哪个版本的***HelpUploadFiles***
2. 捕获哪个窗口（即鼠标移动到哪个窗口再松开）

### 🌛分析使用哪个版本的 ***HelpUploadFiles***

- 可通过任务管理器查看要拦截的程序（如百度网盘）是什么版本，然后采用对应版本的 ***HelpUploadFiles***
- 但这也不是绝对的，有些 64位程序 需要使用 32位版本的 ***HelpUploadFiles***，在64位方案不可行时可考虑验证此方案。(如下文的 ***WinSCP*** )

### 🌜使用经验汇总

#### 🌈使用 32位（x86）版本

|         程序          |                      捕获窗口                      |
| :-------------------: | :------------------------------------------------: |
|    百度网盘客户端     |           主窗口 或 拖拽上传悬浮窗口均可           |
|    腾讯微云客户端     | ❗ **QQ主窗口**（注意此处比较特殊，非腾讯微云窗口） |
|       天翼网盘        |           主窗口 或 拖拽上传悬浮窗口均可           |
|     中国移动硬盘      |           主窗口 或 拖拽上传悬浮窗口均可           |
|        WinSCP         |           主窗口 或 拖拽上传悬浮窗口均可           |
| 360压缩等32位压缩工具 |                  压缩菜单弹出窗口                  |
| Send Anywhere 客户端  |                       主窗口                       |

#### 🌈使用 64位 （x64）版本

|               程序                |     捕获窗口     |
| :-------------------------------: | :--------------: |
|        **Chromium 浏览器**        |     网页页面     |
|          **Edge 浏览器**          |     网页页面     |
|          奶牛快传网页版           |     网页页面     |
|         小飞机网盘网页版          |     网页页面     |
|          阿里网盘网页版           |     网页页面     |
|           123云盘网页版           |     网页页面     |
|          联通网盘网页版           |     网页页面     |
|        谷歌云端硬盘网页版         |     网页页面     |
| 华为云对象存储服务 OBS 控制台网页 |     网页页面     |
| 阿里云对象存储服务 OSS 控制台网页 |     网页页面     |
| 腾讯云对象存储服务 COS 控制台网页 |     网页页面     |
|             LocalSend             |      主窗口      |
|    7z、Bandizip 等64位压缩工具    | 压缩菜单弹出窗口 |

## 🟡已发现的不完全适应情况

- 比特球网盘 未完全兼容，存在目录创建失败问题。